<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ERA-Explore-and-Analyze • ERAg</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="ERA-Explore-and-Analyze">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ERAg</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ERA-Explore-and-Analyze.html">ERA-Explore-and-Analyze</a>
    </li>
    <li>
      <a href="../articles/ERA-Introduction.html">ERA-Introduction</a>
    </li>
    <li>
      <a href="../articles/ERA-Search-Protocol.html">ERA-Search-Protocols-Draft</a>
    </li>
    <li>
      <a href="../articles/ERA-Yield-Stability.html">ERA Yield Stability</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>ERA-Explore-and-Analyze</h1>
                        <h4 data-toc-skip class="author">Peter
Steward</h4>
            
            <h4 data-toc-skip class="date">2025-04-02</h4>
      

      <div class="hidden name"><code>ERA-Explore-and-Analyze.rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="exploring-the-data">Exploring the data<a class="anchor" aria-label="anchor" href="#exploring-the-data"></a>
</h2>
<p>In this vignette we will cover how to visualize ERA data and run
simple meta-analysis.</p>
<div class="section level3">
<h3 id="splitting-combined-practices">Splitting combined practices<a class="anchor" aria-label="anchor" href="#splitting-combined-practices"></a>
</h3>
<p>Observations in the main <code>ERA.Compiled</code> often consist of
bundles of practices which may relate to more than one product.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># No. combination practices</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu">ERAg</span><span class="fu">::</span><span class="va"><a href="../reference/ERA.Compiled.html">ERA.Compiled</a></span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"-"</span>,<span class="va">SubPrName</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 47113</span></span>
<span></span>
<span><span class="co"># No. solo practices</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu">ERAg</span><span class="fu">::</span><span class="va"><a href="../reference/ERA.Compiled.html">ERA.Compiled</a></span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"-"</span>,<span class="va">SubPrName</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 66173</span></span></code></pre></div>
<p>This makes visualization of the dataset difficult as there are over a
1000 sub-practice combinations creating too many values to map onto a
figure. We can use the <code>ERAComboSplit</code> function to “split”
these practice and product combinations into duplicate individual rows
each contain a unique combination of any practice x product combination
present in the original observation.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># There are many subpractice combinations in ERA</span></span>
<span><span class="fu">ERAg</span><span class="fu">::</span><span class="va"><a href="../reference/ERA.Compiled.html">ERA.Compiled</a></span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"-"</span>,<span class="va">SubPrName</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">SubPrName</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 1177</span></span>
<span><span class="fu">ERAg</span><span class="fu">::</span><span class="va"><a href="../reference/ERA.Compiled.html">ERA.Compiled</a></span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">SubPrName</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] "Inputs K-Inputs Micro-Inputs P-Inputs Urea"</span></span>
<span><span class="co">#&gt;  [2] "Inputs K-Inputs P-Inputs Urea"             </span></span>
<span><span class="co">#&gt;  [3] "Inputs P-Inputs Urea"                      </span></span>
<span><span class="co">#&gt;  [4] "Inputs Urea"                               </span></span>
<span><span class="co">#&gt;  [5] "Inputs P"                                  </span></span>
<span><span class="co">#&gt;  [6] "Inputs K"                                  </span></span>
<span><span class="co">#&gt;  [7] "Inputs K-Inputs P"                         </span></span>
<span><span class="co">#&gt;  [8] "Inputs K-Inputs Urea"                      </span></span>
<span><span class="co">#&gt;  [9] "Inputs N-Inputs Urea"                      </span></span>
<span><span class="co">#&gt; [10] "Residue Unkn (nonNfix; NoFate)"</span></span>
<span></span>
<span><span class="co"># Lets split these</span></span>
<span><span class="va">ERA.Compiled.Split</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/ERAComboSplit.html">ERAComboSplit</a></span><span class="op">(</span>Data<span class="op">=</span><span class="fu">ERAg</span><span class="fu">::</span><span class="va"><a href="../reference/ERA.Compiled.html">ERA.Compiled</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The dataset gets longer</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="fu">ERAg</span><span class="fu">::</span><span class="va"><a href="../reference/ERA.Compiled.html">ERA.Compiled</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 113286    137</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">ERA.Compiled.Split</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 209953    143</span></span>
<span></span>
<span><span class="co"># Suffixed .Combo columns contain split names and codes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">".Combo"</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ERA.Compiled.Split</span><span class="op">)</span>,value<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "SubPrName.Combo"       "PrName.Combo"          "Theme.Combo"          </span></span>
<span><span class="co">#&gt; [4] "Product.Simple.Combo"  "Product.Subtype.Combo" "Product.Type.Combo"</span></span>
<span><span class="co"># Combine codes have gone in the .Combo columns</span></span>
<span><span class="va">ERA.Compiled.Split</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"-"</span>,<span class="va">SubPrName.Combo</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">SubPrName.Combo</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co"># Only single values are presnt</span></span>
<span><span class="va">ERA.Compiled.Split</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">SubPrName.Combo</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] "Inputs K"                       "Inputs Micro"                  </span></span>
<span><span class="co">#&gt;  [3] "Inputs P"                       "Inputs Urea"                   </span></span>
<span><span class="co">#&gt;  [5] "Inputs N"                       "Residue Unkn (nonNfix; NoFate)"</span></span>
<span><span class="co">#&gt;  [7] "Irrigation Deficit"             "Irrigation Supp"               </span></span>
<span><span class="co">#&gt;  [9] "Residue Incorp (nonNfix)"       "Mulch (nonNfix)"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="treemaps">Treemaps<a class="anchor" aria-label="anchor" href="#treemaps"></a>
</h3>
<p>We can use the “split” dataset to explore how many instance of
products, practices or outcomes there are. Treemaps are great way of
visualizing these data using the <code><a href="https://rdrr.io/pkg/treemap/man/treemap.html" class="external-link">treemap::treemap()</a></code>
function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># First we count the number of studies per level of the practice heirarchy (see PracticeCodes object for more information on the practice heirarchy)</span></span>
<span><span class="va">ERA.Compiled.Split.Pracs</span><span class="op">&lt;-</span><span class="va">ERA.Compiled.Split</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>N.Studies<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Code</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">SubPrName.Combo</span>,<span class="va">PrName.Combo</span>,<span class="va">Theme.Combo</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ERA.Compiled.Split.Pracs</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   SubPrName.Combo         PrName.Combo         Theme.Combo</span></span>
<span><span class="co">#&gt;                            &lt;char&gt;               &lt;char&gt;              &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:                       Inputs K Inorganic Fertilizer Nutrient Management</span></span>
<span><span class="co">#&gt; 2:                   Inputs Micro Inorganic Fertilizer Nutrient Management</span></span>
<span><span class="co">#&gt; 3:                       Inputs P Inorganic Fertilizer Nutrient Management</span></span>
<span><span class="co">#&gt; 4:                    Inputs Urea Inorganic Fertilizer Nutrient Management</span></span>
<span><span class="co">#&gt; 5:                       Inputs N Inorganic Fertilizer Nutrient Management</span></span>
<span><span class="co">#&gt; 6: Residue Unkn (nonNfix; NoFate)         Crop Residue     Soil Management</span></span>
<span><span class="co">#&gt;    N.Studies</span></span>
<span><span class="co">#&gt;        &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:       264</span></span>
<span><span class="co">#&gt; 2:        80</span></span>
<span><span class="co">#&gt; 3:       498</span></span>
<span><span class="co">#&gt; 4:       277</span></span>
<span><span class="co">#&gt; 5:       406</span></span>
<span><span class="co">#&gt; 6:        21</span></span>
<span></span>
<span><span class="co"># Visualize with the treemap function</span></span>
<span><span class="fu">treemap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/treemap/man/treemap.html" class="external-link">treemap</a></span><span class="op">(</span><span class="va">ERA.Compiled.Split.Pracs</span>,</span>
<span>      index<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Theme.Combo"</span>,<span class="st">"PrName.Combo"</span><span class="op">)</span>,</span>
<span>      vSize<span class="op">=</span><span class="st">"N.Studies"</span>,</span>
<span>      type<span class="op">=</span><span class="st">"index"</span>,</span>
<span>      palette <span class="op">=</span> <span class="st">"Paired"</span>,</span>
<span>      title<span class="op">=</span><span class="st">"Number of Studies reporting ERA practices"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ERA-Explore-and-Analyze_files/figure-html/Treemap-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="analyzing-data">Analyzing Data<a class="anchor" aria-label="anchor" href="#analyzing-data"></a>
</h2>
<p>In this example we will analyze outcomes for the effectiveness of
water harvesting practices using pits.</p>
<p>First let’s explore the ERA <code>PracticeCodes</code> to see where
we might find the names of the practices we are interested in. Theme is
the highest level of organization for practice which of these relate to
water harvesting?</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PracticeCodes</span><span class="op">&lt;-</span><span class="fu">data.table</span><span class="op">(</span><span class="va">PracticeCodes</span><span class="op">)</span></span>
<span></span>
<span><span class="va">PracticeCodes</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Theme</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] "Agroforestry"           "Soil Management"        "Blue Water Management" </span></span>
<span><span class="co">#&gt;  [4] "Green Water Management" "Crop Management"        "Genetic improvement"   </span></span>
<span><span class="co">#&gt;  [7] "Nutrient Management"    "Energy"                 "Animals"               </span></span>
<span><span class="co">#&gt; [10] "Postharvest"            "Non-CSA"                "Water Management"</span></span></code></pre></div>
<p><code>Water Management</code> is a sensible place to look, let’s look
at the practices nesting within this theme.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PracticeCodes</span><span class="op">[</span><span class="va">Theme</span><span class="op">==</span><span class="st">"Water Management"</span>,<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Practice</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] "Irrigation" "Planting"</span></span></code></pre></div>
<p>The <code>Water Harvesting</code> practice is indeed in the
<code>Water Management</code> theme, there are also sub-practices nested
within practices so let’s see what these are for water harvesting.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Note that we are using the Subpractice.S field, this is the field used to generate the names in the ERA.Compiled$SubPrName and ERA.Compiled$SubPrName.Base fields</span></span>
<span><span class="va">PracticeCodes</span><span class="op">[</span><span class="va">Practice</span><span class="op">==</span><span class="st">"Water Harvesting"</span>,<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Subpractice.S</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] "Water Tanks"        "Zai Pits"           "Stone Rows"        </span></span>
<span><span class="co">#&gt;  [4] "Grass Strips"       "Planting Basins"    "Dam"               </span></span>
<span><span class="co">#&gt;  [7] "Terraces"           "Bunds"              "Ridge &amp; Furrow"    </span></span>
<span><span class="co">#&gt; [10] "Tied Ridges"        "Microcatchments"    "Fanya Juu or Chini"</span></span>
<span><span class="co">#&gt; [13] "Trench"</span></span></code></pre></div>
<p>Two of these practices seem to relate to pits
<code>Planting Basins</code> and <code>Zai Pits</code>, let’s check
their definitions to make sure.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">FocalPractices</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Planting Basins"</span>,<span class="st">"Zai Pits"</span><span class="op">)</span></span>
<span><span class="va">PracticeCodes</span><span class="op">[</span><span class="va">Subpractice</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">FocalPractices</span>,<span class="va">Definition</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] "Small pits to capture water. Pits are filled with manure, compost or other nutrient sources before the rainy season. Crops are planted directly into the pits."</span></span>
<span><span class="co">#&gt; [2] "Small planting pits dug to capture water, crops are planted directly into the pits."</span></span></code></pre></div>
<p>Great both are are types of planting pit.</p>
<div class="section level3">
<h3 id="data-availability">Data Availability<a class="anchor" aria-label="anchor" href="#data-availability"></a>
</h3>
<p>Now let’s see what data we have in ERA on these practices</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="op">(</span><span class="va">PitPracs</span><span class="op">&lt;-</span><span class="fu">ERAg</span><span class="fu">::</span><span class="va"><a href="../reference/ERA.Compiled.html">ERA.Compiled</a></span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">FocalPractices</span>,collapse <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span>,<span class="va">SubPrName</span><span class="op">)</span>,<span class="va">SubPrName</span><span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>  <span class="va">table</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span>decreasing <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; .</span></span>
<span><span class="co">#&gt;                                                                        MinTill-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                            661 </span></span>
<span><span class="co">#&gt;                                                                                Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                            361 </span></span>
<span><span class="co">#&gt;                                                        MinTill-Mulch (nonNfix)-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                            107 </span></span>
<span><span class="co">#&gt;                                               AgFor Prune Mulch (Nfix)-MinTill-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                            100 </span></span>
<span><span class="co">#&gt;                                                                Mulch (nonNfix)-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                             92 </span></span>
<span><span class="co">#&gt;                                                                                       Zai Pits </span></span>
<span><span class="co">#&gt;                                                                                             58 </span></span>
<span><span class="co">#&gt;                                            AgFor Prune Mulch (nonNfix)-MinTill-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                             50 </span></span>
<span><span class="co">#&gt;                                                               Planting Basins-Rotation (Mixed) </span></span>
<span><span class="co">#&gt;                                                                                             34 </span></span>
<span><span class="co">#&gt;                                           MinTill-Mulch (Nfix)-Mulch (nonNfix)-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                             28 </span></span>
<span><span class="co">#&gt;                                                                         Inputs Manure-Zai Pits </span></span>
<span><span class="co">#&gt;                                                                                             27 </span></span>
<span><span class="co">#&gt;                                                                   Mulch (noID)-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                             24 </span></span>
<span><span class="co">#&gt;                                                  Mulch (noID)-Planting Basins-Rotation (Mixed) </span></span>
<span><span class="co">#&gt;                                                                                             24 </span></span>
<span><span class="co">#&gt;                                                                         NoTill-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                             21 </span></span>
<span><span class="co">#&gt;                                                     Inputs K-Inputs N-Inputs P-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                             20 </span></span>
<span><span class="co">#&gt;                                       AgFor Alley (Nfix)-AgFor Prune (Unknown)-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                             16 </span></span>
<span><span class="co">#&gt;                  Inputs K-Inputs Manure-Inputs N-Inputs P-MinTill-Mulch (noID)-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                             12 </span></span>
<span><span class="co">#&gt;                                             Inputs Manure-MinTill-Mulch (noID)-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                             12 </span></span>
<span><span class="co">#&gt;                                                                           Inputs Urea-Zai Pits </span></span>
<span><span class="co">#&gt;                                                                                             10 </span></span>
<span><span class="co">#&gt;                                                        Irrigation Supp-MinTill-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                             10 </span></span>
<span><span class="co">#&gt;                                                                Irrigation Supp-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                             10 </span></span>
<span><span class="co">#&gt;                                                           Intercrop (Mixed)-pH-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                              8 </span></span>
<span><span class="co">#&gt;                                                              Intercrop (Mixed)-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                              8 </span></span>
<span><span class="co">#&gt;                                                                       Mulch (nonNfix)-Zai Pits </span></span>
<span><span class="co">#&gt;                                                                                              8 </span></span>
<span><span class="co">#&gt;                                                             Inputs Manure-Inputs Urea-Zai Pits </span></span>
<span><span class="co">#&gt;                                                                                              6 </span></span>
<span><span class="co">#&gt;                                                  MinTill-Planting Basins-Residue Incorp (noID) </span></span>
<span><span class="co">#&gt;                                                                                              6 </span></span>
<span><span class="co">#&gt; Green Manure (Nfix; Time)-MinTill-Planting Basins-Residue Unkn (NoID; NoFate)-Rotation (Mixed) </span></span>
<span><span class="co">#&gt;                                                                                              3 </span></span>
<span><span class="co">#&gt;                               Inputs K-Inputs Manure-Inputs N-Inputs P-MinTill-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                              2 </span></span>
<span><span class="co">#&gt;                                       Inputs K-Inputs Manure-Inputs N-Inputs P-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                              2 </span></span>
<span><span class="co">#&gt;                                             Inputs K-Inputs N-Inputs P-MinTill-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                              2 </span></span>
<span><span class="co">#&gt;                                                      Inputs K-Inputs N-MinTill-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                              2 </span></span>
<span><span class="co">#&gt;                                                              Inputs K-Inputs N-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                              2 </span></span>
<span><span class="co">#&gt;                                                      Inputs K-Inputs P-MinTill-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                              2 </span></span>
<span><span class="co">#&gt;                                                              Inputs K-Inputs P-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                              2 </span></span>
<span><span class="co">#&gt;                                                          Inputs Manure-MinTill-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                              2 </span></span>
<span><span class="co">#&gt;                                                                  Inputs Manure-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                              2 </span></span>
<span><span class="co">#&gt;                                                      Inputs N-Inputs P-MinTill-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                              2 </span></span>
<span><span class="co">#&gt;                                                              Inputs N-Inputs P-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                              2 </span></span>
<span><span class="co">#&gt;                                       MinTill-Mulch (nonNfix)-Planting Basins-Rotation (Mixed) </span></span>
<span><span class="co">#&gt;                                                                                              2 </span></span>
<span><span class="co">#&gt;                                                                               MinTill-Zai Pits </span></span>
<span><span class="co">#&gt;                                                                                              2 </span></span>
<span><span class="co">#&gt;                                 Inputs K-Inputs N-Inputs P-Inputs Urea-MinTill-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                              1 </span></span>
<span><span class="co">#&gt;                                            Inputs Manure-Inputs P-Inputs Urea-MinTill-Zai Pits </span></span>
<span><span class="co">#&gt;                                                                                              1 </span></span>
<span><span class="co">#&gt;                         Intercrop (Mixed)-MinTill-Mulch (Nfix)-Mulch (nonNfix)-Planting Basins </span></span>
<span><span class="co">#&gt;                                                                                              1</span></span></code></pre></div>
<p>Try using the <code>treemap</code> approach as a way of visualizing
the data above.</p>
<p>It seems planting basins are often used in combination with minimum
tillage and mulch, together this is known as conservation agriculture.
Let’s subset the data to where we have a reasonable number of
observations, at least 50.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">PitPracs</span><span class="op">&lt;-</span><span class="va">PitPracs</span><span class="op">[</span><span class="va">PitPracs</span><span class="op">&gt;=</span><span class="fl">50</span><span class="op">]</span> <span class="op">%&gt;%</span> <span class="va">names</span></span>
<span>  <span class="va">ERA.Pits</span><span class="op">&lt;-</span><span class="fu">ERAg</span><span class="fu">::</span><span class="va"><a href="../reference/ERA.Compiled.html">ERA.Compiled</a></span><span class="op">[</span><span class="va">SubPrName</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">PitPracs</span><span class="op">]</span> </span></code></pre></div>
<p>What outcomes do we have data for?</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ERA.Pits.Out</span><span class="op">&lt;-</span><span class="va">ERA.Pits</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>N.Studies<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Code</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">SubPrName</span>,<span class="va">Out.SubInd</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Visualize with the treemap function</span></span>
<span><span class="fu">treemap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/treemap/man/treemap.html" class="external-link">treemap</a></span><span class="op">(</span><span class="va">ERA.Pits.Out</span>,</span>
<span>      index<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Out.SubInd"</span><span class="op">)</span>,</span>
<span>      vSize<span class="op">=</span><span class="st">"N.Studies"</span>,</span>
<span>      type<span class="op">=</span><span class="st">"index"</span>,</span>
<span>      palette <span class="op">=</span> <span class="st">"Paired"</span>,</span>
<span>      title<span class="op">=</span><span class="st">"Outcomes present for pit-based water harvesting practices"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ERA-Explore-and-Analyze_files/figure-html/WH%20visualize%20outcomes-1.png" width="672"></p>
<p>What crops do we have data for?</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ERA.Pits.Crops</span><span class="op">&lt;-</span><span class="va">ERA.Pits</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>N.Studies<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Code</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Product.Simple</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Visualize with the treemap function</span></span>
<span><span class="fu">treemap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/treemap/man/treemap.html" class="external-link">treemap</a></span><span class="op">(</span><span class="va">ERA.Pits.Crops</span>,</span>
<span>      index<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Product.Simple"</span><span class="op">)</span>,</span>
<span>      vSize<span class="op">=</span><span class="st">"N.Studies"</span>,</span>
<span>      type<span class="op">=</span><span class="st">"index"</span>,</span>
<span>      palette <span class="op">=</span> <span class="st">"Paired"</span>,</span>
<span>      title<span class="op">=</span><span class="st">"Crops present for pit-based water harvesting practices"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ERA-Explore-and-Analyze_files/figure-html/WH%20visualize%20products-1.png" width="672"></p>
<p>Where does this data come from?</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ERAgON</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ERAgON/man/ERAHexPlot.html" class="external-link">ERAHexPlot</a></span><span class="op">(</span>Data<span class="op">=</span><span class="va">ERA.Pits</span>,Showpoints <span class="op">=</span> <span class="st">"Yes"</span>,Point.Col <span class="op">=</span> <span class="st">"black"</span>,Mid <span class="op">=</span> <span class="st">"yellow"</span>,</span>
<span>  High <span class="op">=</span> <span class="st">"red"</span>,<span class="op">)</span></span>
<span><span class="co">#&gt; Warning in layer_sf(geom = GeomSf, data = data, mapping = mapping, stat = stat,</span></span>
<span><span class="co">#&gt; : Ignoring unknown aesthetics: <span style="color: #00BB00;">x</span> and <span style="color: #00BB00;">y</span></span></span>
<span><span class="co">#&gt; Warning: `stat(log(count))` was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `after_stat(log(count))` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">ERAgON</span> package.</span></span>
<span><span class="co">#&gt;   Please report the issue to the authors.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span></code></pre></div>
<p><img src="ERA-Explore-and-Analyze_files/figure-html/WH%20map%20data-1.png" width="672"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="va">ERA.Pits</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Country</span><span class="op">)</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ERA.Pits</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span>digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Country</span></span>
<span><span class="co">#&gt;   Ethiopia Mozambique      Niger      Sudan     Zambia   Zimbabwe </span></span>
<span><span class="co">#&gt;        3.0        0.3        3.0        3.5        0.6       89.6</span></span></code></pre></div>
<p>Where can I find the papers that contain this data?</p>
<p><code>ERA.Compiled</code> provides you with some basic bibliographic
data, the most important of which is the <code>DOI</code> file which
enables you to locate the article on-line when adding the prefix
<code>https://doi.org/</code> (e.g.,
<code>https://doi.org/10.1007/s10705-005-6209-9</code>).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ERA.Pits</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Code</span>,<span class="va">Journal</span>,<span class="va">Author</span>,<span class="va">DOI</span><span class="op">)</span><span class="op">]</span> <span class="op">%&gt;%</span>  <span class="va">unique</span></span>
<span><span class="co">#&gt;       Code              Journal         Author                            DOI</span></span>
<span><span class="co">#&gt;     &lt;char&gt;               &lt;char&gt;         &lt;char&gt;                         &lt;char&gt;</span></span>
<span><span class="co">#&gt;  1: NN0035 NUTR CYCL AGROECOSYS     Fatondji D      10.1007/s10705-005-6209-9</span></span>
<span><span class="co">#&gt;  2: NN0304              EXP AGR Mashingaidze N      10.1017/s0014479712001020</span></span>
<span><span class="co">#&gt;  3: HK0259        J SUSTAIN AGR        Umar BB   10.1080/10440046.2012.661700</span></span>
<span><span class="co">#&gt;  4: HK0280      PHYS CHEM EARTH     Mupangwa W      10.1016/j.pce.2007.07.030</span></span>
<span><span class="co">#&gt;  5: HK0281      PHYS CHEM EARTH     Mupangwa W      10.1016/j.pce,2008.06.049</span></span>
<span><span class="co">#&gt;  6: HK0282       FIELD CROP RES     Mupangwa W      10.1016/j.fcr.2012.02.020</span></span>
<span><span class="co">#&gt;  7: HK0283       J ARID ENVIRON     Mupangwa W 10.1016/j.jaridenv.2012.11.007</span></span>
<span><span class="co">#&gt;  8: HK0347            CROP PROT    Mutsamba EF   10.1016/j.cropro.2016.01.004</span></span>
<span><span class="co">#&gt;  9: DK0032       FIELD CROP RES         Kafesu      10.1016/j.fcr.2018.01.014</span></span>
<span><span class="co">#&gt; 10: EO0021   S AFR J PLANT SOIL       Mupangwa  10.1080/02571862.2018.1438673</span></span>
<span><span class="co">#&gt; 11: AG0044        AIMS AGR FOOD       Mupangwa      10.3934/agrfood.2016.1.85</span></span>
<span><span class="co">#&gt; 12: NJ0060            J NEMATOL    Mashavakure       10.21307/jofnem-2018-033</span></span>
<span><span class="co">#&gt; 13: AN0068  RENEW AGR FOOD SYST    Thierfelder      10.1017/S1742170515000332</span></span>
<span><span class="co">#&gt; 14: AN0083        SOIL TILL RES           Sime    10.1016/j.still.2014.12.001</span></span>
<span><span class="co">#&gt; 15: AN0093      LAND DEGRAD DEV   Wildemeersch               10.1002/ldr.2416</span></span>
<span><span class="co">#&gt; 16: AN0123          OUTLOOK AGR            Ali       10.1177/0030727016665034</span></span>
<span><span class="co">#&gt; 17: AN0128             BIOSCI J            Ali   10.14393/BJ-v33n4a2017-33954</span></span>
<span><span class="co">#&gt; 18: NJ0096 NUTR CYCL AGROECOSYS       Nyagumbo      10.1007/s10705-015-9733-2</span></span>
<span><span class="co">#&gt; 19: NJ0106       J SCI FOOD AGR            Ali              10.1002/jsfa.7047</span></span>
<span><span class="co">#&gt; 20: JS0245              EXP AGR          Amede      10.1017/s0014479710000803</span></span>
<span><span class="co">#&gt; 21: AG0053    INT J AGR SUSTAIN       Mupangwa  10.1080/14735903.2015.1011393</span></span>
<span><span class="co">#&gt; 22: EO0020  RENEW AGR FOOD SYST       Mupangwa      10.1017/s1742170516000041</span></span>
<span><span class="co">#&gt;       Code              Journal         Author                            DOI</span></span></code></pre></div>
<p>There is also a <code>DataLoc</code> field in
<code>ERA.Compiled</code> that shows where data were extracted from
within in a publication,</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ERA.Pits</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">DOI</span>,<span class="va">PrName</span>,<span class="va">Out.SubInd</span>,<span class="va">MeanT</span>,<span class="va">MeanC</span>,<span class="va">Units</span>,<span class="va">DataLoc</span><span class="op">)</span><span class="op">]</span> </span>
<span><span class="co">#&gt;                          DOI           PrName Out.SubInd   MeanT   MeanC  Units</span></span>
<span><span class="co">#&gt;                       &lt;char&gt;           &lt;char&gt;     &lt;char&gt;   &lt;num&gt;   &lt;num&gt; &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1: 10.1007/s10705-005-6209-9 Water Harvesting Crop Yield 0.03175 0.02350  Mg/ha</span></span>
<span><span class="co">#&gt; 2: 10.1007/s10705-005-6209-9 Water Harvesting Crop Yield 0.18332 0.14246  Mg/ha</span></span>
<span><span class="co">#&gt; 3: 10.1007/s10705-005-6209-9 Water Harvesting Crop Yield 1.17388 0.71884  Mg/ha</span></span>
<span><span class="co">#&gt; 4: 10.1007/s10705-005-6209-9 Water Harvesting Crop Yield 0.42047 0.10704  Mg/ha</span></span>
<span><span class="co">#&gt; 5: 10.1007/s10705-005-6209-9 Water Harvesting Crop Yield 0.37579 0.26944  Mg/ha</span></span>
<span><span class="co">#&gt;    DataLoc</span></span>
<span><span class="co">#&gt;     &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:  Fig 3a</span></span>
<span><span class="co">#&gt; 2:  Fig 3a</span></span>
<span><span class="co">#&gt; 3:  Fig 3a</span></span>
<span><span class="co">#&gt; 4:  Fig 3b</span></span>
<span><span class="co">#&gt; 5:  Fig 3b</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="prepare-the-data">Prepare the Data<a class="anchor" aria-label="anchor" href="#prepare-the-data"></a>
</h3>
<p>There are some pre-processing steps that we need to apply to the data
using the <code><a href="../reference/PrepareERA.html">ERAg::PrepareERA</a></code> function before conducting a
meta-analysis based on response ratios. These steps include:<br>
1) <em>Negative outcomes</em>: where outcomes have a notable number
(e.g. &gt; 0.5%) of negative values for the control (<code>MeanC</code>
column) or experimental treatment (<code>MeanT</code> column), this is
because negative numbers are incompatible with ratios.<br>
2) <em>Inverse outcomes</em>: when a lower value indicates a better
outcome, the outcome values for control (<code>MeanC</code>) and
experimental treatment (<code>MeanT</code>) are swapped (excluding
economic outcomes).</p>
<p><em>See ?PrepareERA for more details</em></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ERA.Pits.Prep</span><span class="op">&lt;-</span><span class="fu">ERAg</span><span class="fu">::</span><span class="fu"><a href="../reference/PrepareERA.html">PrepareERA</a></span><span class="op">(</span>Data <span class="op">=</span> <span class="va">ERA.Pits</span>,Perc.Neg <span class="op">=</span> <span class="fl">0.5</span>,RmNeg <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Have we lost any data?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">ERA.Pits</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1429  137</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">ERA.Pits.Prep</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1429  137</span></span></code></pre></div>
<p>We haven’t lost any data which means that there were insufficient
negative outcomes to cause us an issue.</p>
<div class="section level4">
<h4 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h4>
<div class="section level5">
<h5 id="key-information">Key Information<a class="anchor" aria-label="anchor" href="#key-information"></a>
</h5>
<p>To analyze the data we will use the <code><a href="../reference/ERAAnalyze.html">ERAg::ERAAnalyze</a></code>
function which performs the following:</p>
<ol style="list-style-type: decimal">
<li><p><code>Weighting</code>: Within-study variance measures for mean
outcomes are infrequently reported in agricultural literature, so
traditional meta-analysis approaches cannot be applied to most ERA
outcomes. Therefore individual observations are up-weighted by
replication and down-weighted by the number of observations submitted
from the same study (<code>Code</code> column) for each combination of
grouping variables. Studies with more replications are likely to produce
less variable information than studies with fewer. Controlling for the
number of observations contributed by a study to the dataset weights
each study equally. As such, outcome ratios are weighted according to:
<code>Weighting = ((RepsE * RepsC)/(RepsE)+(RepsC))/(Ns)</code> where
<code>Rep</code> is the number of replications for <code>RepC</code> the
control and <code>RepE</code> the experimental treatment, and
<code>Ns</code> is the total number of observations contributed to the
overall dataset by the study to which the observation belongs.</p></li>
<li><p><code>Outlier Removal</code>: Outliers are defined using an
extreme outliers method where response ratios above or below
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mo>*</mo><mi>I</mi><mi>Q</mi><mi>R</mi></mrow><annotation encoding="application/x-tex">3*IQR</annotation></semantics></math>
(interquartile range) are removed. The ERA outcome variables analyzed by
this function are ratios between am experimental treatment and control
outcome and should be approximately normally distributed. When the
control approaches zero (e.g. yield collapse) this skews the
distribution of the outcome ratio producing extremely high values
tending to infinity and requiring outlier removal. The use of outcome
ratios, whilst necessary to standardize outcomes between studies, means
this approach is inappropriate to study nil outcomes (e.g. total crop
yield failure), a binomial approach would be better for such instances.
Outlier removal is optional and enabled if the rmOut parameter is set to
TRUE (default).</p></li>
<li><p><code>Test of Normality</code>: A Shapiro-Wilk test is applied to
raw and log-transformed outcome ratios for each combination of grouping
variables. This can be used to judge whether values based on mean
proportional change, mean response ratio or median proportional change
should be used to evaluate practice performance.</p></li>
<li><p><code>Basic Statistical Tests</code>: When
<code>Fast = FALSE</code> where minimum data requirements are met
linear-mixed effects or linear model is applied to the data to generate
means, standard errors and variance. Linear mixed effects models use
<code>lmer::lme4</code> where outcomes from a grouping variable
combination are from at least three sites of which two must have at
least three observations. The model is weighted and includes a random
intercept for site
(<code>lmer(Value~1 + (1|Site),weights=Weights)</code>). If the minimum
data requirements for the linear-mixed effects are not met but there are
at least 5 outcome observations for the grouping variable combination
then a weighted linear model is used
(<code>lm(Value~1,weights=Weights)</code>) . If the minimum data
requirements for the linear model are not met no test is applied to the
outcome values.</p></li>
<li><p><code>Correction of Jensen Inequality</code>: The log-scale
response ratios are back-transformed and converted to % change with and
without a correction for the Jensen inequality. The correction applied
is as per <a href="https://www.biorxiv.org/content/10.1101/179358v1" class="external-link">Tandini &amp;
Mehrabi 2017</a>. We recommend using the corrected values.</p></li>
</ol>
<p>In all case we advise caution in the interpretation of analysis
outputs. The distribution of the data for each combination of values
specified in the <code>Aggregate.By</code> field should be checked
through plotting. Combinations with limited data are vulnerable to
outliers and should be scrutinized carefully.</p>
</div>
<div class="section level5">
<h5 id="calculate-effect-sizes">Calculate Effect Sizes<a class="anchor" aria-label="anchor" href="#calculate-effect-sizes"></a>
</h5>
<p>Ok now that we have an idea what the function is doing let’s run an
analysis of outcomes subindicator (<code>Out.SubInd</code>) by
subpractice (<code>SubPrName</code>) using the
<code><a href="../reference/ERAAnalyze.html">ERAg::ERAAnalyze</a></code> function.</p>
<p>We will not specify a product (i.e. crop) column in the
<code>Aggregate.By</code> argument so results are averaged across all
the crops present within each combination of subindicator x subpractice
as specified by <code>c("Out.SubInd","SubPrName")</code> in the
<code>Aggregate.By</code> argument.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Analysis1</span><span class="op">&lt;-</span><span class="fu">ERAg</span><span class="fu">::</span><span class="fu"><a href="../reference/ERAAnalyze.html">ERAAnalyze</a></span><span class="op">(</span>Data<span class="op">=</span><span class="va">ERA.Pits.Prep</span>,</span>
<span>            <span class="co"># rmOut: Outliers will be removed</span></span>
<span>            rmOut <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>            <span class="co"># Aggregate.By: Data are analyzed as subsets of these fields </span></span>
<span>            Aggregate.By <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Out.SubInd"</span>,<span class="st">"SubPrName"</span><span class="op">)</span>, </span>
<span>            <span class="co"># Fast: Tests will be applied to the data if FALSE</span></span>
<span>            Fast<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> </span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="explore-results">Explore Results<a class="anchor" aria-label="anchor" href="#explore-results"></a>
</h5>
<div class="section level6">
<h6 id="subset-by-minimum-data-requirements">Subset By Minimum Data Requirements<a class="anchor" aria-label="anchor" href="#subset-by-minimum-data-requirements"></a>
</h6>
<p><code>ERAAnalyze</code> outputs a data.table with many columns, we
will run through what many of these are next, but you can also see the
function description for more information
(?<code><a href="../reference/ERAAnalyze.html">ERAg::ERAAnalyze</a></code>).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Analysis1</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "Out.SubInd"       "SubPrName"        "Observations"     "Studies"         </span></span>
<span><span class="co">#&gt;  [5] "Sites"            "RR.Shapiro.Sig"   "RR"               "RR.median"       </span></span>
<span><span class="co">#&gt;  [9] "RR.var"           "RR.se"            "RR.CIlow"         "RR.CIhigh"       </span></span>
<span><span class="co">#&gt; [13] "RR.Quantiles0.25" "PC.Shapiro.Sig"   "PC"               "PC.median"       </span></span>
<span><span class="co">#&gt; [17] "PC.se"            "PC.CIlow"         "PC.CIhigh"        "PC.var"          </span></span>
<span><span class="co">#&gt; [21] "PC.Quantiles0.25" "Units"            "Model"            "MeanT.Obs"       </span></span>
<span><span class="co">#&gt; [25] "MeanT"            "MeanT.se"         "MeanC.Obs"        "MeanC"           </span></span>
<span><span class="co">#&gt; [29] "MeanC.se"         "RR.t value"       "RR.Pr(&gt;|t|)"      "RR.Sigma2"       </span></span>
<span><span class="co">#&gt; [33] "PC.t value"       "PC.Pr(&gt;|t|)"      "PC.Sigma2"        "RR.pc.se.low"    </span></span>
<span><span class="co">#&gt; [37] "RR.pc"            "RR.pc.se.high"    "RR.pc.jen.low"    "RR.pc.jen"       </span></span>
<span><span class="co">#&gt; [41] "RR.pc.jen.high"   "RR.pc.jen.CIlow"  "RR.pc.jen.CIhigh" "PC.pc.se.low"    </span></span>
<span><span class="co">#&gt; [45] "PC.pc"            "PC.pc.se.high"</span></span></code></pre></div>
<p>The first 5 columns describe the subset of data analyzed
(combinations of the fields provided in the <code>Aggregate.By</code>
argument) and the amount of data that were available.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Analysis1</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Out.SubInd</span>, <span class="va">SubPrName</span>, <span class="va">Observations</span>, <span class="va">Studies</span>, <span class="va">Sites</span><span class="op">)</span><span class="op">]</span> <span class="op">%&gt;%</span>  <span class="va">head</span></span>
<span><span class="co">#&gt;                       Out.SubInd       SubPrName Observations Studies Sites</span></span>
<span><span class="co">#&gt;                           &lt;char&gt;          &lt;char&gt;        &lt;int&gt;   &lt;int&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:                    Crop Yield        Zai Pits           28       3     4</span></span>
<span><span class="co">#&gt; 2:            Crop Residue Yield        Zai Pits           12       1     2</span></span>
<span><span class="co">#&gt; 3:          Water Use Efficiency        Zai Pits           11       2     3</span></span>
<span><span class="co">#&gt; 4:                    Crop Yield Planting Basins          119       9    10</span></span>
<span><span class="co">#&gt; 5: Nitrogen Agronomic Efficiency Planting Basins            4       1     1</span></span>
<span><span class="co">#&gt; 6:          Water Use Efficiency Planting Basins            9       1     1</span></span></code></pre></div>
<p>We can use the data availability fields to filter the results to
combinations that meet a minimum data requirement, let’s specify a
minimum of 3 studies.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Analysis1</span><span class="op">&lt;-</span><span class="va">Analysis1</span><span class="op">[</span><span class="va">Studies</span><span class="op">&gt;=</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">Analysis1</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Out.SubInd</span>, <span class="va">SubPrName</span>, <span class="va">Observations</span>, <span class="va">Studies</span>, <span class="va">Sites</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;           Out.SubInd                               SubPrName Observations</span></span>
<span><span class="co">#&gt;               &lt;char&gt;                                  &lt;char&gt;        &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:        Crop Yield                                Zai Pits           28</span></span>
<span><span class="co">#&gt; 2:        Crop Yield                         Planting Basins          119</span></span>
<span><span class="co">#&gt; 3:        Crop Yield                 MinTill-Planting Basins           31</span></span>
<span><span class="co">#&gt; 4:     Soil Moisture                         Planting Basins           78</span></span>
<span><span class="co">#&gt; 5: Infiltration Rate                         Planting Basins           11</span></span>
<span><span class="co">#&gt; 6:        Crop Yield MinTill-Mulch (nonNfix)-Planting Basins           51</span></span>
<span><span class="co">#&gt; 7:     Soil Moisture                 MinTill-Planting Basins          588</span></span>
<span><span class="co">#&gt;    Studies Sites</span></span>
<span><span class="co">#&gt;      &lt;int&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:       3     4</span></span>
<span><span class="co">#&gt; 2:       9    10</span></span>
<span><span class="co">#&gt; 3:       5     5</span></span>
<span><span class="co">#&gt; 4:       6     7</span></span>
<span><span class="co">#&gt; 5:       3     3</span></span>
<span><span class="co">#&gt; 6:       4     7</span></span>
<span><span class="co">#&gt; 7:       3     5</span></span></code></pre></div>
</div>
<div class="section level6">
<h6 id="response-ratios">Response Ratios<a class="anchor" aria-label="anchor" href="#response-ratios"></a>
</h6>
<p>A response ratio (RR) is simply the natural log of the ratio of the
experimental outcome to the control outcome. If maize yields with
planting basins are 1.5 Mg/ha and without them are 1.1 Mg/ha the
response ratio is log(1.5/1.1) = 0.310. RRs greater than zero indicate
the experimental treatment is better than the control and vice-versa for
RRs less than zero.</p>
<p>Measures of central tendency and error for RRs are provided in the
fields prefixed with <code>RR.</code> and include mean
(<code>RR</code>), median, variance, standard error and quantiles at 25%
intervals. If a test was applied to the data then the mean and standard
error are derived from that test.</p>
<p>A Shapiro-Wilks test of normality is applied to RRs. If a value in
the <code>RR.Shapiro.Sig</code> field is &lt;0.05 then the data for that
row are statistically non-normal therefore estimates of central tendency
and tests results may be unreliable.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Analysis1</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Out.SubInd</span>,<span class="va">SubPrName</span>,<span class="va">RR.Shapiro.Sig</span>, <span class="va">RR</span>, <span class="va">RR.median</span>, <span class="va">RR.var</span>, <span class="va">RR.se</span>, <span class="va">RR.Quantiles0.25</span><span class="op">)</span><span class="op">]</span> <span class="op">%&gt;%</span> <span class="va">head</span></span>
<span><span class="co">#&gt;           Out.SubInd                               SubPrName RR.Shapiro.Sig</span></span>
<span><span class="co">#&gt;               &lt;char&gt;                                  &lt;char&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:        Crop Yield                                Zai Pits        0.02136</span></span>
<span><span class="co">#&gt; 2:        Crop Yield                         Planting Basins        0.01802</span></span>
<span><span class="co">#&gt; 3:        Crop Yield                 MinTill-Planting Basins        0.34706</span></span>
<span><span class="co">#&gt; 4:     Soil Moisture                         Planting Basins        0.00643</span></span>
<span><span class="co">#&gt; 5: Infiltration Rate                         Planting Basins        0.53826</span></span>
<span><span class="co">#&gt; 6:        Crop Yield MinTill-Mulch (nonNfix)-Planting Basins        0.00001</span></span>
<span><span class="co">#&gt;         RR   RR.median  RR.var   RR.se</span></span>
<span><span class="co">#&gt;      &lt;num&gt;       &lt;num&gt;   &lt;num&gt;   &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 1.60856  1.56759080 1.93062 0.41504</span></span>
<span><span class="co">#&gt; 2: 0.34048  0.28430648 0.18272 0.08592</span></span>
<span><span class="co">#&gt; 3: 0.35755  0.95097629 0.05203 0.16766</span></span>
<span><span class="co">#&gt; 4: 0.13466  0.18669793 0.05141 0.05812</span></span>
<span><span class="co">#&gt; 5: 0.04268 -0.09502693 0.06270 0.07082</span></span>
<span><span class="co">#&gt; 6: 0.32865  0.15415068 0.18962 0.17219</span></span>
<span><span class="co">#&gt;                              RR.Quantiles0.25</span></span>
<span><span class="co">#&gt;                                        &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:     0.17618|0.6611|1.50677|2.05494|4.89784</span></span>
<span><span class="co">#&gt; 2:    -1.28606|0.10469|0.28327|0.66602|1.4929</span></span>
<span><span class="co">#&gt; 3:   -0.34971|0.78828|0.84251|0.89675|0.95098</span></span>
<span><span class="co">#&gt; 4:   -0.39531|0.02917|0.17919|0.35003|0.64185</span></span>
<span><span class="co">#&gt; 5: -0.17829|-0.12999|-0.09863|0.16834|0.53714</span></span>
<span><span class="co">#&gt; 6:   -0.50858|-0.01417|0.1463|0.30769|2.93563</span></span></code></pre></div>
<p>If tests were performed (argument <code>Fast=F</code>) then test
results presented in the <code>t value</code>, <code>Pr(&gt;|t|)</code>
and <code>Sigma2</code>. The <code>Pr(&gt;|t|)</code> field indicates
significance.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Analysis1</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Out.SubInd</span>,<span class="va">SubPrName</span>,<span class="va">Model</span>, <span class="va">`RR`</span>,<span class="va">`RR.se`</span>,<span class="va">`RR.t value`</span>, <span class="va">`RR.Pr(&gt;|t|)`</span>, <span class="va">RR.Sigma2</span><span class="op">)</span><span class="op">]</span> <span class="op">%&gt;%</span> <span class="va">head</span></span>
<span><span class="co">#&gt;           Out.SubInd                               SubPrName           Model</span></span>
<span><span class="co">#&gt;               &lt;char&gt;                                  &lt;char&gt;          &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:        Crop Yield                                Zai Pits lmerModLmerTest</span></span>
<span><span class="co">#&gt; 2:        Crop Yield                         Planting Basins lmerModLmerTest</span></span>
<span><span class="co">#&gt; 3:        Crop Yield                 MinTill-Planting Basins lmerModLmerTest</span></span>
<span><span class="co">#&gt; 4:     Soil Moisture                         Planting Basins lmerModLmerTest</span></span>
<span><span class="co">#&gt; 5: Infiltration Rate                         Planting Basins              lm</span></span>
<span><span class="co">#&gt; 6:        Crop Yield MinTill-Mulch (nonNfix)-Planting Basins lmerModLmerTest</span></span>
<span><span class="co">#&gt;         RR   RR.se RR.t value RR.Pr(&gt;|t|) RR.Sigma2</span></span>
<span><span class="co">#&gt;      &lt;num&gt;   &lt;num&gt;      &lt;num&gt;       &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 1.60856 0.41504    3.87563     0.03317   0.25526</span></span>
<span><span class="co">#&gt; 2: 0.34048 0.08592    3.96281     0.00343   0.02497</span></span>
<span><span class="co">#&gt; 3: 0.35755 0.16766    2.13255     0.09646   0.00706</span></span>
<span><span class="co">#&gt; 4: 0.13466 0.05812    2.31702     0.05524   0.00260</span></span>
<span><span class="co">#&gt; 5: 0.04268 0.07082    0.60264     0.56017   0.02508</span></span>
<span><span class="co">#&gt; 6: 0.32865 0.17219    1.90870     0.11167   0.01603</span></span></code></pre></div>
<p>For easier interpretation mean RR and RR +/- standard error are
back-transformed and converted into percentage change (e.g., a ratio of
1.1 = a 10% increase). The <code>RR.pc.</code> columns back-transform
log ratios using the exponent. The <code>RR.pc.jen.</code> columns
back-transform log ratios using the exponent with a correction for the
Jensen inequality.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Analysis1</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Out.SubInd</span>,<span class="va">SubPrName</span>, <span class="va">RR.pc.se.low</span>, <span class="va">RR.pc</span>, <span class="va">RR.pc.se.high</span>, <span class="va">RR.pc.jen.low</span>, <span class="va">RR.pc.jen.high</span><span class="op">)</span><span class="op">]</span> <span class="op">%&gt;%</span> <span class="va">head</span></span>
<span><span class="co">#&gt;           Out.SubInd                               SubPrName RR.pc.se.low</span></span>
<span><span class="co">#&gt;               &lt;char&gt;                                  &lt;char&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:        Crop Yield                                Zai Pits    229.86721</span></span>
<span><span class="co">#&gt; 2:        Crop Yield                         Planting Basins     28.98939</span></span>
<span><span class="co">#&gt; 3:        Crop Yield                 MinTill-Planting Basins     20.91166</span></span>
<span><span class="co">#&gt; 4:     Soil Moisture                         Planting Basins      7.95454</span></span>
<span><span class="co">#&gt; 5: Infiltration Rate                         Planting Basins     -2.77478</span></span>
<span><span class="co">#&gt; 6:        Crop Yield MinTill-Mulch (nonNfix)-Planting Basins     16.93640</span></span>
<span><span class="co">#&gt;        RR.pc RR.pc.se.high RR.pc.jen.low RR.pc.jen.high</span></span>
<span><span class="co">#&gt;        &lt;num&gt;         &lt;num&gt;         &lt;num&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 399.56124     656.55118     274.77288      759.54243</span></span>
<span><span class="co">#&gt; 2:  40.56221      53.17333      30.60992       55.09769</span></span>
<span><span class="co">#&gt; 3:  42.98221      69.08139      21.33923       69.67930</span></span>
<span><span class="co">#&gt; 4:  14.41477      21.26160       8.09497       21.41934</span></span>
<span><span class="co">#&gt; 5:   4.36039      12.01919      -1.54790       13.43275</span></span>
<span><span class="co">#&gt; 6:  38.90916      65.01068      17.87741       66.33855</span></span></code></pre></div>
</div>
<div class="section level6">
<h6 id="proportional-change">Proportional change<a class="anchor" aria-label="anchor" href="#proportional-change"></a>
</h6>
<p>Analyses are performed on the “raw” ratio of experimental to control
outcomes, these columns are prefixed <code>PC.</code>. The proportional
change columns are as per the response ratio columns, but there are no
<code>.jen.</code> columns as values are not logged.</p>
<p>We urge caution in using statistics based on proportional data due to
the imbalanced scaling of ratios below or above one. Ratio or proportion
data is often right skewed as values cannot be lower than zero but can
tend to infinity.</p>
</div>
<div class="section level6">
<h6 id="investigate-distributions">Investigate distributions<a class="anchor" aria-label="anchor" href="#investigate-distributions"></a>
</h6>
<p>Below we compare percent changes estimates using the ratio
vs. response ratio.</p>
<p>The different statistics/methods give different effect size estimates
and have different amounts of data availability. Generally the more data
that are available the closer the convergence of the methods, although
not always.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add percentage change results based on median</span></span>
<span><span class="va">Analysis1</span><span class="op">[</span>,<span class="va">PC.pc.median</span><span class="op">:=</span><span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="va">PC.median</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">Analysis1</span><span class="op">[</span>,<span class="va">RR.pc.median</span><span class="op">:=</span><span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="va">RR.median</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">Analysis1</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Out.SubInd</span>,<span class="va">SubPrName</span>,<span class="va">Observations</span>,<span class="va">RR.pc.jen</span>,<span class="va">RR.pc.median</span>,<span class="va">PC.pc</span>,<span class="va">PC.pc.median</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;           Out.SubInd                               SubPrName Observations</span></span>
<span><span class="co">#&gt;               &lt;char&gt;                                  &lt;char&gt;        &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:        Crop Yield                                Zai Pits           28</span></span>
<span><span class="co">#&gt; 2:        Crop Yield                         Planting Basins          119</span></span>
<span><span class="co">#&gt; 3:        Crop Yield                 MinTill-Planting Basins           31</span></span>
<span><span class="co">#&gt; 4:     Soil Moisture                         Planting Basins           78</span></span>
<span><span class="co">#&gt; 5: Infiltration Rate                         Planting Basins           11</span></span>
<span><span class="co">#&gt; 6:        Crop Yield MinTill-Mulch (nonNfix)-Planting Basins           51</span></span>
<span><span class="co">#&gt; 7:     Soil Moisture                 MinTill-Planting Basins          588</span></span>
<span><span class="co">#&gt;    RR.pc.jen RR.pc.median    PC.pc PC.pc.median</span></span>
<span><span class="co">#&gt;        &lt;num&gt;        &lt;num&gt;    &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 467.56778    56.759080 1523.465   379.508197</span></span>
<span><span class="co">#&gt; 2:  42.32813   -71.569352   52.000    32.884013</span></span>
<span><span class="co">#&gt; 3:  43.48782    -4.902371   53.348   158.823529</span></span>
<span><span class="co">#&gt; 4:  14.56361   -81.330207   16.424    20.526316</span></span>
<span><span class="co">#&gt; 5:   5.67731  -109.502693    7.208    -9.065156</span></span>
<span><span class="co">#&gt; 6:  40.02699   -84.584932   84.019    16.666667</span></span>
<span><span class="co">#&gt; 7:  13.29785   -83.794414   14.169    17.592593</span></span></code></pre></div>
<p>A check of the normality of the data reveals potential issues and
these are only “solved” (according to the significance of the
Shapiro-Wilks test) by logging the data in one instance (Soil Moisture
and MinTill-Planting Basins).</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Analysis1</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Out.SubInd</span>,<span class="va">SubPrName</span>, <span class="va">RR.Shapiro.Sig</span>, <span class="va">PC.Shapiro.Sig</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;           Out.SubInd                               SubPrName RR.Shapiro.Sig</span></span>
<span><span class="co">#&gt;               &lt;char&gt;                                  &lt;char&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:        Crop Yield                                Zai Pits        0.02136</span></span>
<span><span class="co">#&gt; 2:        Crop Yield                         Planting Basins        0.01802</span></span>
<span><span class="co">#&gt; 3:        Crop Yield                 MinTill-Planting Basins        0.34706</span></span>
<span><span class="co">#&gt; 4:     Soil Moisture                         Planting Basins        0.00643</span></span>
<span><span class="co">#&gt; 5: Infiltration Rate                         Planting Basins        0.53826</span></span>
<span><span class="co">#&gt; 6:        Crop Yield MinTill-Mulch (nonNfix)-Planting Basins        0.00001</span></span>
<span><span class="co">#&gt; 7:     Soil Moisture                 MinTill-Planting Basins        0.00000</span></span>
<span><span class="co">#&gt;    PC.Shapiro.Sig</span></span>
<span><span class="co">#&gt;             &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:        0.00000</span></span>
<span><span class="co">#&gt; 2:        0.00000</span></span>
<span><span class="co">#&gt; 3:        0.00395</span></span>
<span><span class="co">#&gt; 4:        0.00002</span></span>
<span><span class="co">#&gt; 5:        0.32726</span></span>
<span><span class="co">#&gt; 6:        0.00000</span></span>
<span><span class="co">#&gt; 7:        0.00000</span></span></code></pre></div>
<p>Let’s check the data distribution. If we take the combination of
<code>Soil Moisture</code> and <code>MinTill-Planting Basins</code>
plotting the outcome response ratio and ratio vs a normal curve it
shows: 1) the right skew (due to the nature of ratio data) in the ratio
data is corrected by the natural log transformation; 2) whilst the
response ratio distribution is not quite normal, it’s not terrible
either and probably good enough for our purposes.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RR</span><span class="op">&lt;-</span><span class="va">ERA.Pits.Prep</span><span class="op">[</span><span class="va">Out.SubInd</span><span class="op">==</span><span class="st">"Soil Moisture"</span>   <span class="op">&amp;</span> <span class="va">SubPrName</span><span class="op">==</span><span class="st">"MinTill-Planting Basins"</span>,<span class="va">yi</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">RR</span>, prob<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x</span>, mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">RR</span><span class="op">)</span>, sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">RR</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, col<span class="op">=</span><span class="st">"darkblue"</span>, lwd<span class="op">=</span><span class="fl">2</span>, add<span class="op">=</span><span class="cn">TRUE</span>, yaxt<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ERA-Explore-and-Analyze_files/figure-html/WH%20-%20Comparison%203-1.png" width="672"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">Proportion</span><span class="op">&lt;-</span><span class="va">ERA.Pits.Prep</span><span class="op">[</span><span class="va">Out.SubInd</span><span class="op">==</span><span class="st">"Soil Moisture"</span>   <span class="op">&amp;</span> <span class="va">SubPrName</span><span class="op">==</span><span class="st">"MinTill-Planting Basins"</span>,<span class="va">MeanT</span><span class="op">/</span><span class="va">MeanC</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">Proportion</span>, prob<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x</span>, mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Proportion</span><span class="op">)</span>, sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">Proportion</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, col<span class="op">=</span><span class="st">"darkblue"</span>, lwd<span class="op">=</span><span class="fl">2</span>, add<span class="op">=</span><span class="cn">TRUE</span>, yaxt<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ERA-Explore-and-Analyze_files/figure-html/WH%20-%20Comparison%203-2.png" width="672"></p>
</div>
</div>
<div class="section level5">
<h5 id="example-of-issue-with-ordering-of-numerator-and-denominator">Example of issue with ordering of numerator and denominator<a class="anchor" aria-label="anchor" href="#example-of-issue-with-ordering-of-numerator-and-denominator"></a>
</h5>
<p>Interestingly results can change if the numerator and denominator are
swapped. For example:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Con</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>,<span class="fl">1500</span>,<span class="fl">2000</span><span class="op">)</span> <span class="co"># Control outcomes</span></span>
<span><span class="va">Exp</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1100</span>,<span class="fl">500</span>,<span class="fl">1200</span><span class="op">)</span> <span class="co"># Experimental outcomes</span></span>
<span></span>
<span><span class="co"># ***Experimental outcome is numerator***</span></span>
<span><span class="va">Exp</span><span class="op">/</span><span class="va">Con</span></span>
<span><span class="co">#&gt; [1] 1.1000000 0.3333333 0.6000000</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Exp</span><span class="op">/</span><span class="va">Con</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.6777778</span></span>
<span><span class="co"># % change estimated from mean of ratios</span></span>
<span><span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Exp</span><span class="op">/</span><span class="va">Con</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] -32.22222</span></span>
<span><span class="co"># % change estimated from mean of response ratios</span></span>
<span><span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Exp</span><span class="op">/</span><span class="va">Con</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] -39.63189</span></span>
<span></span>
<span><span class="co"># ***Control outcome is numerator***</span></span>
<span><span class="va">Con</span><span class="op">/</span><span class="va">Exp</span></span>
<span><span class="co">#&gt; [1] 0.9090909 3.0000000 1.6666667</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Con</span><span class="op">/</span><span class="va">Exp</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.858586</span></span>
<span><span class="co"># % change estimated from mean of ratios</span></span>
<span><span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Con</span><span class="op">/</span><span class="va">Exp</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 85.85859</span></span>
<span><span class="co"># % change estimated from mean of response ratios</span></span>
<span><span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Con</span><span class="op">/</span><span class="va">Exp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 65.65038</span></span></code></pre></div>
<p>When averaging ratios if the experimental treatment is the numerator
then the experimental treatment yields -32.2% less than the control, and
if the control treatment is the numerator then we find the control
yields 85.9% more than the experimental treatment. The results using
response ratios are less dispersed (-39.6% vs 65.7%).</p>
<p>Which is true: 1) the control is 65.7% better than the experimental
treatment or 2) the experimental treatment is 39.6% worse than the
control?</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Peter Steward.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
