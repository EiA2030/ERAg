<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Prepare ERA Data — PrepareERA • ERAg</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Prepare ERA Data — PrepareERA"><meta property="og:description" content="This function prepares the ERA dataset for the analysis of outcome ratios. Several actions are applied:
Where a lower value indicates a better outcome, the outcome values for control (MeanC) and treatment (MeanT) are swapped. This excludes economic outcomes.
A logical column MeanFlip is added to the output dataset to indicate if outcome values have been swapped. Response ratios (yi) and percentage change (pc) are recalculated.
Non-ERA practices (h-codes) are removed from the base.practice list (eventually this will be moved to compilation).
Rows with blank practice names (PrName) are filtered from the supplied dataset.
The inverse of efficiency outcomes that are In/Out (267.1 and 265.1) is taken (1/value) and the outcome code (267 &amp;amp; 265) and naming columns are renamed accordingly.
Outcomes with a percentage of negative values &amp;gt; Perc.Neg are filtered from the supplied dataset.
Practice names (PrNames) can optionally be be encoded and output as combinations. For more details see the DoCombinations and CombineAll parameter descriptions.

"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ERAg</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/ERA-Explore-and-Analyze.html">ERA-Explore-and-Analyze</a>
    </li>
    <li>
      <a href="../articles/ERA-Introduction.html">ERA-Introduction</a>
    </li>
    <li>
      <a href="../articles/ERA-Search-Protocol.html">ERA-Search-Protocols-Draft</a>
    </li>
    <li>
      <a href="../articles/ERA-Yield-Stability.html">ERA Yield Stability</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Prepare ERA Data</h1>

    <div class="hidden name"><code>PrepareERA.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function prepares the ERA dataset for the analysis of outcome ratios. Several actions are applied:</p><ol><li><p>Where a lower value indicates a better outcome, the outcome values for control (<em>MeanC</em>) and treatment (<em>MeanT</em>) are swapped. This excludes economic outcomes.
A logical column <em>MeanFlip</em> is added to the output dataset to indicate if outcome values have been swapped. Response ratios (<em>yi</em>) and percentage change (<em>pc</em>) are recalculated.</p></li>
<li><p>Non-ERA practices (h-codes) are removed from the base.practice list (eventually this will be moved to compilation).</p></li>
<li><p>Rows with blank practice names (<em>PrName</em>) are filtered from the supplied dataset.</p></li>
<li><p>The inverse of efficiency outcomes that are In/Out (267.1 and 265.1) is taken (1/value) and the outcome code (267 &amp; 265) and naming columns are renamed accordingly.</p></li>
<li><p>Outcomes with a percentage of negative values &gt; <strong>Perc.Neg</strong> are filtered from the supplied dataset.</p></li>
<li><p>Practice names (<em>PrNames</em>) can optionally be be encoded and output as combinations. For more details see the <strong>DoCombinations</strong> and <strong>CombineAll</strong> parameter descriptions.</p></li>
</ol></div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">PrepareERA</span><span class="op">(</span></span>
<span>  <span class="va">Data</span>,</span>
<span>  CombineAll <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  DoCombinations <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  Perc.Neg <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  RmNeg <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  Invert2xNeg <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  PLevel <span class="op">=</span> <span class="st">"Practice"</span>,</span>
<span>  Delim <span class="op">=</span> <span class="st">"-"</span>,</span>
<span>  Cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Code"</span>, <span class="st">"Country"</span>, <span class="st">"Latitude"</span>, <span class="st">"Longitude"</span>, <span class="st">"Site.Type"</span>, <span class="st">"ID"</span>, <span class="st">"Site.ID"</span>,</span>
<span>    <span class="st">"Rep"</span>, <span class="st">"Diversity"</span>, <span class="st">"Tree"</span>, <span class="st">"Variety"</span>, <span class="st">"Duration"</span>, <span class="st">"M.Year"</span>, <span class="st">"EU"</span>, <span class="st">"EUlist"</span>,</span>
<span>    <span class="st">"Outcode"</span>, <span class="st">"MeanC"</span>, <span class="st">"MeanC.Error"</span>, <span class="st">"MeanT"</span>, <span class="st">"MeanT.Error"</span>, <span class="st">"Mean.Error.Type"</span>,</span>
<span>    <span class="st">"Units"</span>, <span class="st">"TID"</span>, <span class="st">"CID"</span>, <span class="st">"MeanFlip"</span>, <span class="st">"Neg.Vals"</span>, <span class="st">"plist"</span>, <span class="st">"base.list"</span>, <span class="st">"Product"</span>,</span>
<span>    <span class="st">"Product.Type"</span>, <span class="st">"Product.Subtype"</span>, <span class="st">"Product.Simple"</span>, <span class="st">"Out.Pillar"</span>, <span class="st">"Out.SubPillar"</span>,</span>
<span>    <span class="st">"Out.Ind"</span>, <span class="st">"Out.SubInd"</span>, <span class="st">"SubPrName"</span>, <span class="st">"PrName"</span>, <span class="st">"Theme"</span>, <span class="st">"SubPrName.Base"</span>,</span>
<span>    <span class="st">"PrName.Base"</span>, <span class="st">"T.Descrip"</span>, <span class="st">"C.Descrip"</span>, </span>
<span>     <span class="st">"C.NI"</span>, <span class="st">"C.NO"</span>, <span class="st">"T.NI"</span>, <span class="st">"T.NO"</span>,</span>
<span>    <span class="st">"Partial.Outcome.Name"</span>, <span class="st">"Partial.Outcome.Code"</span>, <span class="st">"DataLoc"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-data">Data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>The compiled ERA dataset</p></dd>


<dt id="arg-combineall">CombineAll<a class="anchor" aria-label="anchor" href="#arg-combineall"></a></dt>
<dd><p>Logical <code>T/F</code>. Applies only when DoCombinations is <code>TRUE.</code> When set to TRUE all rows containing a practice (alone or in combination with other practices) are copied to the
Data.Combos table and renamed. When set FALSE only the rows of a practice where it occurs in combination with other practice are copied to the Data.Combos table and renamed.
Default = F.</p></dd>


<dt id="arg-docombinations">DoCombinations<a class="anchor" aria-label="anchor" href="#arg-docombinations"></a></dt>
<dd><p>Logical <code>T/F</code>. When set to TRUE rows with &gt;1 experimental practice are duplicated for the number of practices present and PrName/SubPrName fields changed to one of those practices
(e.g. if PrName is Mulch-BioChar then the row is duplicated (n=2) with PrName in row 1 as Mulch and in row 2 as BioChar). The copied rows are joined and the function output changes to a list of two data.tables, "Data"
and "Data.Combos" . Note ONLY the PrName/SubPrName field is changed in the Data.Combos table, all other fields remain the same. Default = <code>F</code>.</p></dd>


<dt id="arg-perc-neg">Perc.Neg<a class="anchor" aria-label="anchor" href="#arg-perc-neg"></a></dt>
<dd><p>A numeric vector of length one defining the maximum percentage of negative values allowed for an outcome x practice combination. If an outcome x practice has a higher percentage of negative values than <code>Perc.Neg</code>
it is filtered from the dataset. Default = 0.5.</p></dd>


<dt id="arg-invert-xneg">Invert2xNeg<a class="anchor" aria-label="anchor" href="#arg-invert-xneg"></a></dt>
<dd><p>Swaps MeanT and MeanC values where they are both negative. Less negative values become better than more negative values.</p></dd>


<dt id="arg-plevel">PLevel<a class="anchor" aria-label="anchor" href="#arg-plevel"></a></dt>
<dd><p>choose <code>Practice</code> or <code>Subpractice</code> to determine hierarchical level at which practice combinations are detected. To make the function more generalizable you can also include the column name of a field here.</p></dd>


<dt id="arg-delim">Delim<a class="anchor" aria-label="anchor" href="#arg-delim"></a></dt>
<dd><p>Character. The delimter that separates multiple names within a character string (for example the delimiter <code>-</code> separates two practices in the string <code>Inorganic Fertilizer-Organic Fertilizer</code>)</p></dd>


<dt id="arg-cols">Cols<a class="anchor" aria-label="anchor" href="#arg-cols"></a></dt>
<dd><p>A vector of column names to retain from the ERA dataset supplied. Default values are supplied.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>If DoCombinations = F a data.table of the processed ERA dataset. If DoCombinations = T a list of two data.tables, "Data" as per combinations = F and "Data.Combos" where
PrNames/SubPrName have been modified to reflect combination practices.</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Peter Steward.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

