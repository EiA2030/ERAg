<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Analyze Outcome Ratios — ERAAnalyze • ERAg</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Analyze Outcome Ratios — ERAAnalyze"><meta property="og:description" content="This function analyzes outcome ratios in the ERA dataset for each combination of grouping variables as specified by column names in the Aggregate.By parameter. We suggest
applying the ERA.Prepare function to data before using with this function."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ERAg</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/ERA-Explore-and-Analyze.html">ERA-Explore-and-Analyze</a>
    </li>
    <li>
      <a href="../articles/ERA-Introduction.html">ERA-Introduction</a>
    </li>
    <li>
      <a href="../articles/ERA-Search-Protocol.html">ERA-Search-Protocols-Draft</a>
    </li>
    <li>
      <a href="../articles/ERA-Yield-Stability.html">ERA Yield Stability</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Analyze Outcome Ratios</h1>

    <div class="hidden name"><code>ERAAnalyze.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function analyzes outcome ratios in the ERA dataset for each combination of grouping variables as specified by column names in the <code>Aggregate.By</code> parameter. We suggest
applying the <code>ERA.Prepare</code> function to data before using with this function.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ERAAnalyze</span><span class="op">(</span><span class="va">Data</span>, rmOut <span class="op">=</span> <span class="cn">T</span>, <span class="va">Aggregate.By</span>, ROUND <span class="op">=</span> <span class="fl">5</span>, Fast <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-data">Data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A preapred ERA dataset (see PrepareERA function)</p></dd>


<dt id="arg-rmout">rmOut<a class="anchor" aria-label="anchor" href="#arg-rmout"></a></dt>
<dd><p>Logical T/F. If TRUE extreme outliers are detected and removed for each combination of grouping variables.</p></dd>


<dt id="arg-aggregate-by">Aggregate.By<a class="anchor" aria-label="anchor" href="#arg-aggregate-by"></a></dt>
<dd><p>Column names for grouping variables. Statistics will be compiled for each combination of these variables.</p></dd>


<dt id="arg-round">ROUND<a class="anchor" aria-label="anchor" href="#arg-round"></a></dt>
<dd><p>Integer value for the number of decimal places numeric columns in the output dataset should be rounded to.</p></dd>


<dt id="arg-fast">Fast<a class="anchor" aria-label="anchor" href="#arg-fast"></a></dt>
<dd><p>Logical T/F. If <code>FALSE</code> then lmer and lm models are used to estimate means, errors and significance if sufficient data exist.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A data.table of response ratios and percentage change values, each row representing a combination of the grouping variables specified in the Aggregrate.By parameter. <code>RR</code> = outcome response ratio $log(MeanT/MeanC)$, <code>PC</code> = outcome proportional change $MeanT/MeanC$.</p>
<p>Output columns when <code>Fast</code> is <code>TRUE</code>:</p><ul><li><p><code>Observations</code> = no. rows of data</p></li>
<li><p><code>Studies</code> = no. studies (publications)</p></li>
<li><p><code>Sites</code> = no. of geographic locations</p></li>
<li><p><code>RR.Shapiro.Sig</code> = P-value from a Shapiro-Wilk test of RR</p></li>
<li><p><code>RR</code> = weighted mean of RR</p></li>
<li><p><code>RR</code> = weighted median of RR</p></li>
<li><p><code>RR.se</code> = weighted standard error of RR</p></li>
<li><p><code>RR.CIlow</code> = lower 95% confidence interval of RR</p></li>
<li><p><code>RR.CIhigh</code> = upper 95% confidence interval of RR</p></li>
<li><p><code>RR.var</code> = weighted variance of RR</p></li>
<li><p><code>RR.Quantiles05</code> = weighted quantiles of the RR</p></li>
<li><p><code>PC.Shapiro.Sig</code> = P-value from a Shapiro-Wilk test of PC</p></li>
<li><p><code>PC</code> = weighted mean of PC</p></li>
<li><p><code>PC</code> = weighted median of PC</p></li>
<li><p><code>PC.se</code> = weighted standard error of PC</p></li>
<li><p><code>PC.CIlow</code> = lower 95% confidence interval of PC</p></li>
<li><p><code>PC.CIhigh</code> = upper 95% confidence interval of PC</p></li>
<li><p><code>PC.var</code> = weighted variance of PC</p></li>
<li><p><code>PC.Quantiles05</code> = weighted quantiles of the PC</p></li>
<li><p><code>PC.pc</code> = percent change based on PC (<code>100 x PC - 100</code>)</p></li>
<li><p><code>PC.pc.se.low</code> = lower standard error confidence interval of % change based on PC</p></li>
<li><p><code>PC.pc.se.high</code> = upper standard error confidence interval of % change based on PC</p></li>
<li><p><code>RR.pc</code> = % change based on RR (<code>100 x exp(RR) - 100</code>)</p></li>
<li><p><code>RR.pc.se.low</code> = lower standard error confidence interval of % change based on RR</p></li>
<li><p><code>RR.pc.se.high</code> = upper standard error confidence interval of % change based on RR</p></li>
<li><p><code>RR.pc.jen</code> = % change based on RR with correction for Jensen inequality (<code>100 x exp(RR+RR.var/2) - 100</code>)</p></li>
<li><p><code>RR.pc.jen.low</code> = lower standard error confidence interval of % change based on RR with correction for Jensen inequality</p></li>
<li><p><code>RR.pc.jen.high</code> = upper standard error confidence interval of % change based on RR with correction for Jensen inequality</p></li>
<li><p><code>RR.pc.jen.CIlow</code> = lower 95% confidence interval of % change based on RR with correction for Jensen inequality</p></li>
<li><p><code>RR.pc.jen.CIhigh</code> = upper 95% standard error confidence interval of % change based on RR with correction for Jensen inequality
Where all units are indentical for the grouping variables (row) then the following columns will have values (else they are NA):</p></li>
<li><p><code>Units</code> = the unit of recording for an outcome (e.g. kg/ha)</p></li>
<li><p><code>MeanT.Obs</code> = number of experimental treatment observations</p></li>
<li><p><code>MeanT</code> = weighted mean of experimental treatment outcome values</p></li>
<li><p><code>MeanT.se</code> = weighted standard error of experimental treatment outcome values</p></li>
<li><p><code>MeanC.Obs</code> = number of control treatment observations</p></li>
<li><p><code>MeanC</code> = weighted mean of control treatment outcome values</p></li>
<li><p><code>MeanC.se</code> = weighted standard error of contol treatment outcome values</p></li>
</ul><p>When <code>Fast = TRUE</code> means, standard errors and confidence intervals are replaced by estimates from, in order of preference, lmer then lm models, if the model minimum data
requirements are met. Percentage change data is then calculated from the updated estimates.</p>
<p>Additional columns when <code>Fast = FALSE</code>:</p><ul><li><p><code>Model</code> = type of model that was applied to data, <code>NA</code> = no model was applied.</p></li>
<li><p><code>RR.t.value</code> = t statistic from RR model</p></li>
<li><p><code>RR.Pr(&gt;|t|)</code> = probability that the outcome is not equal to zero from RR model</p></li>
<li><p><code>RR.Sigma2</code> = RR model sigma2</p></li>
<li><p><code>PC.t.value</code> = t statistic from PC model</p></li>
<li><p><code>PC.Pr(&gt;|t|)</code> = probability that the outcome is not equal to zero from PC model</p></li>
<li><p><code>PC.Sigma2</code> = PC model sigma2</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p>Several actions are or can be applied by this function:</p><ol><li><p>Outlier Removal: Outliers are defined using an extreme outliers method where values above or below $3*IQR$ (interquartile range) are removed. The ERA outcome variables
analyzed by this function are ratios between am experimental treatment and control outcome and should be approximately normally distributed. When the control approaches
zero (e.g. yield collapse) this skews the distribution of the outcome ratio producing extremely high values tending to infinity and requiring outlier removal.
The use of outcome ratios, whilst necessary to standardize outcomes between studies, means this approach is inappropriate to study nil outcomes (e.g. total crop yield failure),
a binomial approach would be better for such instances. Outlier removal is optional and enabled if the rmOut parameter is set to TRUE (default).</p></li>
<li><p>Weighting: Within-study variance measures for mean outcomes are infrequently reported in agricultural literature, so traditional meta-analytic approaches cannot be applied
to most ERA outcomes. Therefore individual observations are up-weighted by replication and down-weighted by the number of observations submitted from the same study (colname =
Code) for each combination of grouping variables. Studies with more replications are likely to produce less variable information than studies with fewer. Controlling for
the number of #' observations contributed by a study to the dataset weights each study equally.   As such, outcome ratios are weighted according to:
<code>Weighting = ((RepsE * RepsC)/(RepsE)+(RepsC))/(Ns)</code>  where <code>Rep</code> is the number of replications for <code>RepC</code> the control and <code>RepE</code> the experimental
treatment, and <code>Ns</code> is the total number of observations contributed to the overall dataset by the study to which the observation belongs.</p></li>
<li><p>Test of Normality: A Shapiro-Wilk test ( <a href="https://rdrr.io/r/stats/shapiro.test.html" class="external-link">shapiro.test</a>) is applied to raw and log-transformed outcome ratios for each combination of grouping variables. This can be used
to judge whether values based on mean proportional change, mean response ratio or median proportional change should be used to evaluate practice performance.</p></li>
<li><p>Statistics calculated (in all cases na.rm=T):</p><ul><li><p><em>weighted means</em> use the <a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a> function</p></li>
<li><p><em>weighted medians</em> use the <a href="https://rdrr.io/pkg/spatstat.univar/man/weighted.median.html" class="external-link">weighted.median</a> function</p></li>
<li><p><em>weighted standard errors</em> use the <a href="https://rdrr.io/pkg/diagis/man/weighted_se.html" class="external-link">weighted_se</a> function</p></li>
<li><p><em>95% confidence intervals</em> use the <a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a> function with <code>method = "Wald"</code></p></li>
<li><p><em>weighted variance</em> uses the wtd.stats <code>wtd.var</code> function</p></li>
<li><p><em>weighted quantiles</em> use the <a href="https://rdrr.io/pkg/spatstat.univar/man/weighted.median.html" class="external-link">weighted.median</a> (<code>weighted.quantile</code>) function with <code>probs=seq(0,1,0.25)</code></p></li>
</ul></li>
<li><p>Response ratios are back-transformed and converted to % change with and without a correction for the Jensen inequality.
The correction applied is as per <a href="https://www.biorxiv.org/content/10.1101/179358v1" class="external-link">Tandini &amp; Mehrabi 2017</a>.</p></li>
<li><p>When <code>Fast = FALSE</code> where minimum data requirements are met linear-mixed effects or linear model is applied to the data to generate means, standard errors and variance.</p><ul><li><p>Linear mixed effects models use lme4 where outcomes from a grouping variable combination are from at least three sites of which two must have at
least three observations. The model is weighted and includes a random intercept for site (<code>lmer(Value~1 + (1|Site),weights=Weights)</code>).</p></li>
<li><p>If the minimum data requirements for the lmer are not met then a linear model with weights is applied (<code>lm(Value~1,weights=Weights)</code>) if there are at least 5 outcome observations for the grouping variable combination.</p></li>
<li><p>If the minimum data requirements for the lm are not met no test is applied to the outcome values.</p></li>
</ul></li>
</ol><p>Also note that any groupings of data specified in the Aggregate.By parameter for which values of MeanC and MeanT are identical are removed from the dataset before analysis.</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Peter Steward.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

